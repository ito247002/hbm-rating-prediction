# 階層ベイズモデルを用いた商品評価予測システム 要求設計書

## 1. プロジェクト概要

### 1.1 目的
少数のレビューしかない新商品や、ニッチな商品の真の評価値を階層ベイズモデルを用いて予測することにより、より信頼性の高い商品評価システムを構築する。

### 1.2 背景
- ECサイトにおいて、新商品や特殊な商品は十分なレビューが集まらない
- 1〜2件の極端なレビューに基づく評価では、商品の真の品質を判断できない
- ユーザーが商品選択時に適切な判断材料を得られない

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 コア機能
- **評価予測機能**: レビューが少ない商品の5段階評価（1〜5星）の真の評価値を予測
- **階層モデリング機能**: 商品カテゴリごとの評価傾向を学習し、個別商品の予測に活用
- **信頼区間計算機能**: 予測値の不確実性を定量化

#### 2.1.2 データ処理機能
- **レビューデータ取得**: 商品ID、レビュー評価、商品カテゴリの情報を処理
- **カテゴリ分類**: 商品を適切なカテゴリ（家電、書籍、アパレル等）に分類
- **データ前処理**: 欠損値処理、異常値検出

#### 2.1.3 予測結果表示機能
- **予測評価値表示**: 予測された平均評価と95%信頼区間を表示
- **予測分布可視化**: 各星評価の確率分布を棒グラフで表示
- **信頼度指標**: 予測の確からしさを示す指標を提供

### 2.2 性能要件

#### 2.2.1 精度要件
- レビュー数10件以下の商品で、実評価との平均絶対誤差0.8以下
- カテゴリ平均評価の推定精度：標準誤差0.5以下

#### 2.2.2 処理性能要件
- 単一商品の評価予測：1秒以内
- バッチ処理（1000商品）：10分以内
- モデル学習：よりデモ的な簡潔なデータ更新、10分程度で終了するようにする

### 2.3 技術要件

#### 2.3.1 使用技術
- **統計モデリング**: PyMC（ベイズ統計モデリング）
- **データ処理**: NumPy, Pandas
- **可視化**: Matplotlib, ArviZ
- **言語**: Python 3.8以上

#### 2.3.2 モデル仕様
- **階層構造**: 
  - カテゴリレベル：カテゴリごとの評価傾向（家電、書籍、アパレル等）
  - 個別レベル：個別商品の評価
- **確率分布**: ベータ二項分布を基本とした評価モデル（1-5星評価に適合）
- **サンプリング**: MCMC（マルコフ連鎖モンテカルロ）による事後分布推定

## 3. システム構成

### 3.1 入力データ
- **商品レビューデータ**: 商品ID、レビュー評価（1〜5）、投稿日時
- **商品マスタデータ**: 商品ID、商品名、カテゴリID、発売日
- **カテゴリマスタデータ**: カテゴリID、カテゴリ名

### 3.2 出力データ
- **予測評価**: 商品ID、予測平均評価、95%信頼区間（下限・上限）
- **予測分布**: 各星評価（1〜5）の確率
- **カテゴリ統計**: カテゴリごとの平均評価と標準偏差

## 4. ユーザーインターフェース要件

### 4.1 表示要件
- 予測評価の表示形式：「予測評価: ⭐4.5 (95%の確率で 4.1〜4.8 の範囲)」
- 予測分布の棒グラフ表示
- レビュー件数と予測信頼度の関係表示

### 4.2 操作要件
- 商品ID指定による単一商品予測
- カテゴリ指定による一括予測
- 予測結果のCSVエクスポート機能

## 5. 制約事項・前提条件

### 5.1 制約事項
- レビューがゼロ件の商品は予測対象外
- カテゴリが未分類の商品は「その他」カテゴリとして処理
- 最大カテゴリ数：100カテゴリまで

### 5.2 前提条件
- レビューデータが定期的に更新される
- 商品カテゴリ分類が適切に行われている
- 計算リソース（CPU/メモリ）が十分に確保されている

## 6. 不明点・要確認事項

### 6.1 ビジネス要件
- **対象カテゴリの範囲**: どの商品カテゴリを対象とするか（特定カテゴリを対象とする）
- **更新頻度**: モデルの再学習頻度（階層ベイズを学ぶことを目標としているので1度限り）
- **予測対象商品の条件**: レビュー件数10件以下の商品を予測対象とする

### 6.2 技術的詳細
- **カテゴリ階層**: デモ用途のため2階層構造（カテゴリ→個別商品）を採用し、サブカテゴリは使用しない
- **季節性考慮**: 時期による評価傾向の変化の考慮は行わない
- **レビューの重み付け**: 投稿日時やレビュアーの信頼度による重みづけは行わない

### 6.3 運用面
- **異常検知**: 明らかに不正なレビューの検出・除外方法(不正なレビューがあまりない価格ドットコム、というサイトを対象に実験を行おうとしている、そのため検出、除外方法は考慮しない)
- **モニタリング**: 予測精度の継続的監視方法(継続して監視は行わない)
- **バックアップ**: モデルパラメータはpickle形式で保存・復旧を行う

### 6.4 スケーラビリティ
- **データ量の上限**: 処理可能な商品数・レビュー数の上限(デモ版での稼働を考えているため少量)
- **リアルタイム処理**: 新規レビュー投稿時のリアルタイム予測更新要否(リアルタイム処理不要)
- **分散処理**: 大規模データに対する分散処理の必要性(不要)